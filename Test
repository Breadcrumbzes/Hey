local Players = game:GetService("Players")
local player = Players.LocalPlayer

local function convertMotor6DToRagdoll(motor)
	local part0 = motor.Part0
	local part1 = motor.Part1
	if not (part0 and part1) then return end

	local attachment0 = Instance.new("Attachment")
	attachment0.CFrame = motor.C0
	attachment0.Name = "RagdollAttachment0"
	attachment0.Parent = part0

	local attachment1 = Instance.new("Attachment")
	attachment1.CFrame = motor.C1
	attachment1.Name = "RagdollAttachment1"
	attachment1.Parent = part1

	local socket = Instance.new("BallSocketConstraint")
	socket.Attachment0 = attachment0
	socket.Attachment1 = attachment1
	socket.Parent = part0

	motor.Enabled = false
end

local function ragdollCharacter(character)
	local humanoid = character:FindFirstChildOfClass("Humanoid")


	-- Unanchor all parts
	for _, part in ipairs(character:GetDescendants()) do
		if part:IsA("BasePart") then
			part.Anchored = false
		end
	end

	-- Replace all Motor6Ds
	for _, desc in ipairs(character:GetDescendants()) do
		if desc:IsA("Motor6D") then
			convertMotor6DToRagdoll(desc)
		end
	end

	-- Launch player
	local root = character:FindFirstChild("HumanoidRootPart")
	if root then
		root.Velocity = Vector3.new(math.random(-150,150), 2000, math.random(-150,150))
	end

	-- Play sound
	local head = character:FindFirstChild("Head")
	if head then
		local sound = Instance.new("Sound")
		sound.SoundId = "rbxassetid://15599005570"
		sound.Volume = 10
		sound.PlayOnRemove = true
		sound.Parent = head
		sound:Destroy()
	end
end

local function run()
	local character = player.Character or player.CharacterAdded:Wait()
	local humanoid = character:WaitForChild("Humanoid")
	humanoid.BreakJointsOnDeath = false
	task.wait(0.1) -- tiny delay just in case
	ragdollCharacter(character)
end

run()
